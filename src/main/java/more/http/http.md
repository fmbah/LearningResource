# HTTP协议浅解

## HTTP 概念
> HTTP是一种能够获取如 HTML 这样的网络资源的 protocol(通讯协议)。
> 它是在 Web 上进行数据交换的基础，是一种 client-server 协议，
> 也就是说，请求通常是由像浏览器这样的接受方发起的。
> 一个完整的Web文档通常是由不同的子文档拼接而成的，
> 像是文本、布局描述、图片、视频、脚本等等

1. 基于HTTP组件的组件
    1. 客户端： user-agent
    ````
    user-agent 就是任何能够为用户发起行为的工具。
    这个角色通常都是由浏览器来扮演。
    一些例外情况，比如是工程师使用的程序，
    以及Web开发人员调试应用程序。
    ````
    2. WEB服务端
    3. 代理
    ````
    缓存（可以是公开的也可以是私有的，像浏览器的缓存）
    过滤（像反病毒扫描，家长控制...）
    负载均衡（让多个服务器服务不同的请求）
    认证（对不同资源进行权限管理）
    日志记录（允许存储历史信息）
    ````
2. HTTP 的基本性质
    1. HTTP是简单的
    2. HTTP是可扩展的
    3. HTTP是无状态的，可有会话的
    ````
    注：cookie 放在 请求头中，让每一次请求都共享相同的上下文信息
    那么 session cookie 哪个更好呢? 
    ````
    4. HTTP和连接
        1. HTTP1.0 每一次请求创建一个新的tcp连接，过于频繁速度慢
        2. HTTP2.0 一个连接复用消息的方式让这个连接始终保持为暖连接

## HTTP工作原理
````
 HTTP协议采用请求/响应模式，客户端向服务器发送一个请求报文，然后服务器响应请求。
 下面介绍一下一次HTTP请求的过程：
 1. 在浏览器中输入URL，并按下回车键
 2. 浏览器向DNS服务器请求解析该URL中的域名对应的IP地址(如果是IP请求，则不需要该步骤)
 3. 解析出IP后，根据IP和端口号，和服务器建立TCP连接
 4. 浏览器向服务器发送请求，该请求报文作为TCP三次握手的第三个报文发送给服务器
 5. 服务器做出响应，把数据发送给浏览器
 6. 通信完成，断开TCP连接
 7. 浏览器解析收到的数据并显示
````
## 网络通信
````
网卡 MAC地址
IP 地址

1. 访问京东域名
2. 先将请求发给交换机，然后交给了路由器，路由发给了DNS服务器，通过DNS协议寻找访问的京东IP地址
3. 查到京东IP后，路由通过协议找到最优路径，将请求信息转发给这个IP地址的京东路由器
4. 京东路由器发给了京东网站的服务器上
5. 京东网站的服务器将响应 原路返回
6. 从第一步开始的时候，你的计算机分配了一个端口用来进行数据交互，当京东回复消息的时候，通过这个端口找到你的浏览器，浏览器最后拿到京东的数据，展示到浏览器上

7. 第二步涉及到了DNS服务器解析过程
    1. 浏览器缓存DNS记录，chrome://net-internals/#dns 查看chormeDNS缓存。
    2. 操作系统缓存： 如果浏览器缓存中找不到需要的DNS记录，那就去操作系统中找。cmd命令ipconfig /displaydns 用于查看操作系统dns缓存。
    3. 路由缓存： 路由器也有DNS缓存。 找本机的hosts文件 Windows host文件路径： C:\WINDOWS\system32\drivers\etc\hosts （由于直接修改之后不能保存，可以copy一份到桌面，修改之后，在替换掉原路径下的文件就可以了）,hosts文件以静态映射的方式提供IP地址与主机名的对照表。
    4. ISP(网络服务提供商)：如果还是没有，那么就去检查ISP有没有吧~,每一个ISP（网络服务提供商），或一个大学，甚至是一个大学里的系都会有一个自己的本地域名服务器，他会在url第一次访问时缓存该域名的指向。下次再访问时，他会从缓存里把这个url曾经指向的IP调出来。

8 第三步首先涉及到了网关、路由器、交换机
    1. 当局域网S内的a主机想和局域网D中的b主机通信，但是发现两者根本不在同一个局域网中，
       如果想通信，在没有路由器的情况下，则必须将数据发送至局域网S的网关A，通过网关A找到
       局域网D的网关B，网关B在转发给局域网D的主机b,这样就实现了通信
    2. 当京东路由器拿到了这个请求之后，会转发给内网的服务器，这里就是一个映射关系，
       只要访问我这个110.110.110.110:8000的请求，都去找服务器A；路由器的外网通信都是通过接口wlan转发出去的
       相当于不管你内网哪个服务器，最终请求都通过路由的外网接口发送出去；至于你的内网到底通过哪个lan接口转发出去
       具体看分配IP的配置，静态？动态？
    3. 交换机起到桥接作用，只要是同一个网络的机器通过交换机连接，都可以进行通信
````
![网络拓扑图](https://images2018.cnblogs.com/blog/988061/201809/988061-20180909111944359-1323196399.png)
![DNS寻址](https://images2018.cnblogs.com/blog/988061/201809/988061-20180909112504683-1737949469.png)
![基本的网络](https://images2018.cnblogs.com/blog/988061/201809/988061-20180903162123427-525619134.png)
[HTTP MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP)
[网络通信](https://www.cnblogs.com/clschao/articles/9613442.html)
## OSI七层模型 TCP/IP分层模型